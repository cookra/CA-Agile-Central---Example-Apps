<!DOCTYPE html>
<html>
<head>
    <title>Rally-TeamCombobox-Example</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",itemId:"controlsContainer",columnWidth:1}],_projectUsersStore:null,_artifactTypeCombobox:null,_getProjectUsersStore:function(projectOID){var me=this,urlTemplate="https://rally1.rallydev.com/slm/webservice/x/project/{0}/projectusers.js?query={1}&order={2}&dir={3}&fetch={4}",order="UserName,ObjectID",dir="ASC,ASC",query="((TeamMember = true) AND (Disabled = false))",fetch="UserName,FirstName,LastName,DisplayName,Disabled,Permission,TeamMember",fields=["_ref","UserName","FirstName","LastName","DisplayName","Disabled","Permission","TeamMember"],projectUsersURL=Ext.String.format(urlTemplate,projectOID,query,order,dir,fetch),projectUsersProxy=new Ext.data.proxy.Rest({url:projectUsersURL,headers:{},reader:{type:"json",root:"QueryResult.Results"}}),newRecords=[],userRefURLTemplate="https://{0}/slm/webservice/v2.0/user/{1}",userStore=Ext.create("Ext.data.Store",{fields:fields,restful:!0,proxy:projectUsersProxy,listeners:{load:function(store,data,success){var records=data;Ext.Array.each(records,function(record){var ref=record.get("_ref"),refSplit=ref.split("/"),baseUrl=refSplit[2],userOID=refSplit[refSplit.length-1].split(".")[0],userRef=Ext.String.format(userRefURLTemplate,baseUrl,userOID),newUserRecord={_ref:userRef,UserName:record.get("UserName"),FirstName:record.get("FirstName"),LastName:record.get("LastName"),DisplayName:record.get("DisplayName"),Disabled:record.get("Disabled"),Permission:record.get("Permission"),TeamMember:record.get("TeamMember")};newRecords.push(newUserRecord)}),me._projectUsersStore=Ext.create("Ext.data.Store",{fields:fields,data:newRecords}),me._buildComboBox()}}}).load()},_buildComboBox:function(){this._artifactTypeCombobox=Ext.create("Ext.form.ComboBox",{fieldLabel:"Choose Project User",store:this._projectUsersStore,queryMode:"local",displayField:"DisplayName",valueField:"UserName",listeners:{scope:this,select:this._onUserSelected}}),this.down("#controlsContainer").add(this._artifactTypeCombobox)},_onUserSelected:function(combobox){Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Selected User",message:"UserName of Selected User:"+combobox.getValue(),confirmLabel:"Ok",listeners:{confirm:function(){}}})},launch:function(){var currentProjectRef=this.getContext().getProjectRef(),currentProjectOID=Ext.create("Rally.util.Ref",currentProjectRef).getOid();this._getProjectUsersStore(currentProjectOID)}});

            Rally.launchApp('CustomApp', {
                name:"Rally-TeamCombobox-Example",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
